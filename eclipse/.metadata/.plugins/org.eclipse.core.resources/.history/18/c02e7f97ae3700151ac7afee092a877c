package com.magiology.render.aftereffect;

import net.minecraft.client.Minecraft;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.util.AxisAlignedBB;
import net.minecraft.world.World;

import org.lwjgl.opengl.GL11;

import com.magiology.core.init.MItems;
import com.magiology.mcobjects.tileentityes.TileEntityFirePipe;
import com.magiology.objhelper.helpers.Helper;
import com.magiology.objhelper.helpers.renderers.GL11H;

public class RenderFirePipePriorityCube implements LongAfterRenderRenderer{
	
	private boolean isDead=false;
	public  double alpha=0;
	private final double speed;
	private final AxisAlignedBB box;
	private final int x,y,z;
	private final World world;
	public final TileEntityFirePipe pipe;
	private static EntityPlayer player=Minecraft.getMinecraft().thePlayer;
	
	public RenderFirePipePriorityCube(TileEntityFirePipe pipe,BlockPos pos, AxisAlignedBB b){
		this.x=x;
		this.y=y;
		this.z=z;
		this.box=b;
		this.pipe=pipe;
		this.speed=0.06;
		alpha=speed;
		world=pipe.getWorldObj();
	}
	
	@Override
	public void render(){
		GL11.glPushMatrix();
		GL11H.SetUpOpaqueRendering(2);
		GL11.glDisable(GL11.GL_TEXTURE_2D);
//		GL11.glDisable(GL11.GL_CULL_FACE);
//		GL11.glDisable(GL11.GL_FOG);
		GL11.glTranslatef(pos);
		GL11.glDepthMask(false);
		GL11.glColor4d(1, 0.1, 0.1, alpha/5);
		if(box!=null)for(int a=0;a<5;a++)drawCube(box.minX-a*0.01+Helper.CRandF(0.005), box.minY-a*0.01+Helper.CRandF(0.005), box.minZ-a*0.01+Helper.CRandF(0.005), box.maxX+a*0.01+Helper.CRandF(0.005), box.maxY+a*0.01+Helper.CRandF(0.005), box.maxZ+a*0.01+Helper.CRandF(0.005));
		GL11.glColor4d(0.1, 0.1, 1, alpha*2/5);
		for(int a=0;a<5;a++)drawCube(pipe.collisionBoxes[6].minX-0.001-a*0.01+(a==0?0:Helper.CRandF(0.005)), pipe.collisionBoxes[6].minY-0.001-a*0.01+(a==0?0:Helper.CRandF(0.005)), pipe.collisionBoxes[6].minZ-0.001-a*0.01+(a==0?0:Helper.CRandF(0.005)),pipe.collisionBoxes[6].maxX+0.001+a*0.01+(a==0?0:Helper.CRandF(0.005)), pipe.collisionBoxes[6].maxY+0.001+a*0.01+(a==0?0:Helper.CRandF(0.005)), pipe.collisionBoxes[6].maxZ+0.001+a*0.01+(a==0?0:Helper.CRandF(0.005)));
		GL11.glPopMatrix();
		GL11.glDepthMask(true);
//		GL11.glEnable(GL11.GL_CULL_FACE);
		GL11.glEnable(GL11.GL_TEXTURE_2D);
		GL11H.EndOpaqueRendering();
		GL11.glColor4d(1,1,1,1);
	}
	
	@Override
	public void update(){
		if(Helper.isItemInStack(MItems.FireHammer, player.inventory.mainInventory[player.inventory.currentItem]))
			 alpha+=speed;
		else alpha-=speed;
		double maxAlpha=0.3;
		if(alpha>maxAlpha)alpha=maxAlpha;
		else if(alpha<=0){kill();return;}
	}
	
	@Override
	public boolean isDead(){return isDead;}
	@Override
	public void kill(){isDead=true;}
	public void drawCube(double minx,double miny,double minz,double maxx,double maxy,double maxz){
		tess.startDrawingQuads();
		tess.setNormal(0.0F, -1F, 0.0F);
		tess.addVertex(minx, miny, maxz);
		tess.addVertex(minx, miny, minz);
		tess.addVertex(maxx, miny, minz);
		tess.addVertex(maxx, miny, maxz);
		tess.finishDrawing();
		tess.startDrawingQuads();
		tess.setNormal(0.0F, 1.0F, 0.0F);
		tess.addVertex(maxx, maxy, maxz);
		tess.addVertex(maxx, maxy, minz);
		tess.addVertex(minx, maxy, minz);
		tess.addVertex(minx, maxy, maxz);
		tess.finishDrawing();
		tess.startDrawingQuads();
		tess.setNormal(0.0F, 0.0F, -1F);
		tess.addVertex(maxx, maxy, minz);
		tess.addVertex(maxx, miny, minz);
		tess.addVertex(minx, miny , minz);
		tess.addVertex(minx, maxy, minz);
		tess.finishDrawing();
		tess.startDrawingQuads();
		tess.setNormal(0.0F, 0.0F, 1.0F);
		tess.addVertex(minx, maxy, maxz);
		tess.addVertex(minx, miny , maxz);
		tess.addVertex(maxx, miny, maxz);
		tess.addVertex(maxx, maxy, maxz);
		tess.finishDrawing();
		tess.startDrawingQuads();
		tess.setNormal(-1F, 0.0F, 0.0F);
		tess.addVertex(minx, maxy, minz);
		tess.addVertex(minx, miny, minz);
		tess.addVertex(minx, miny, maxz);
		tess.addVertex(minx, maxy, maxz);
		tess.finishDrawing();
		tess.startDrawingQuads();
		tess.setNormal(1.0F, 0.0F, 0.0F);
		tess.addVertex(maxx, maxy, maxz);
		tess.addVertex(maxx, miny,  maxz);
		tess.addVertex(maxx, miny,  minz);
		tess.addVertex(maxx, maxy, minz);
		tess.finishDrawing();
	}
}
