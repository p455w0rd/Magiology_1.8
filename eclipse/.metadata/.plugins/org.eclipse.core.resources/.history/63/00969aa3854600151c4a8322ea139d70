package com.magiology.core;

import java.lang.reflect.Constructor;
import java.util.Map;

import net.minecraft.client.renderer.ItemModelMesher;
import net.minecraft.client.renderer.texture.TextureAtlasSprite;
import net.minecraft.client.resources.model.ModelResourceLocation;
import net.minecraft.item.Item;
import net.minecraft.util.ResourceLocation;
import net.minecraftforge.fml.relauncher.Side;
import net.minecraftforge.fml.relauncher.SideOnly;

import com.magiology.objhelper.DataStalker;
import com.magiology.objhelper.Get;

public class Fixes1_8{
	//--------------------------------------------------------------------------------------------------------------------------------//
	private static Map simpleShapes,simpleShapesCache;
	
	private static int getIndex(Item item, int meta){
        return Item.getIdFromItem(item) << 16 | meta;
    }
	@SideOnly(value=Side.CLIENT)
	public static void injectStandardJsonModel(Item item, int meta, ModelResourceLocation location){
		if(simpleShapes==null){
			simpleShapes=DataStalker.getVariable(ItemModelMesher.class, "simpleShapes", Get.Render.RI().getItemModelMesher());
			simpleShapesCache=DataStalker.getVariable(ItemModelMesher.class, "simpleShapesCache", Get.Render.RI().getItemModelMesher());
		}
		simpleShapes.put(Integer.valueOf(getIndex(item, meta)), location);
        simpleShapesCache.put(Integer.valueOf(getIndex(item, meta)), Get.Render.RI().getItemModelMesher().getModelManager().getModel(location));
	}
	private static Constructor<TextureAtlasSprite> constr;
	public static TextureAtlasSprite TextureAtlasSprite(ResourceLocation location){
		try{
			if(constr==null){
				constr=TextureAtlasSprite.class.getDeclaredConstructor(String.class);
				constr.setAccessible(true);
			}
			return constr.newInstance(location.toString());
		}catch(Exception e){
			e.printStackTrace();
		}
		return null;
	}
	
	//--------------------------------------------------------------------------------------------------------------------------------//
	
}
