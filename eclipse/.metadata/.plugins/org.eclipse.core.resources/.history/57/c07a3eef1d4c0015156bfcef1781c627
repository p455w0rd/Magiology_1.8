package com.magiology.gui;

import java.util.ArrayList;

import net.minecraft.client.renderer.WorldRenderer;
import net.minecraft.util.ResourceLocation;

import org.lwjgl.opengl.GL11;
import org.lwjgl.util.vector.Vector2f;

import com.magiology.core.MReference;
import com.magiology.gui.fpgui.FirstPersonGui;
import com.magiology.modedmcstuff.ColorF;
import com.magiology.objhelper.helpers.Helper.H;
import com.magiology.objhelper.helpers.renderers.GL11H;
import com.magiology.objhelper.helpers.renderers.TessHelper;

public class DownloadingIcon {
	private static ResourceLocation main=new ResourceLocation(MReference.MODID,"/textures/gui/downloading.png");
	
	private static ArrayList<Drop> drops=new ArrayList<Drop>();
	
	public static void update(){
		if(H.RB(0.5))drops.add(new Drop(new Vector2f(H.RF(130)+14, 60),H.RF(0.25)+0.75F));
		for(int i=0;i<drops.size();i++){
			Drop drop=drops.get(i);
			drop.speed++;
			drop.prevPos=drop.pos;
			drop.prevAlpha=drop.alpha;
			
			drop.pos.y+=drop.speed;
			drop.alpha=(260F-drop.pos.y)/260*2;
			if(drop.alpha<0)drop.dead=true;
		}
	}
	public static void draw(ColorF color){
		GL11.glPushMatrix();
		GL11H.SetUpOpaqueRendering(1);
		WorldRenderer tess=TessHelper.getWR();
		TessHelper.bindTexture(main);
		
		for(Drop drop:drops){
			GL11.glPushMatrix();
			GL11.glColor4f(1, 1, 1, H.calculateRenderPos(drop.prevAlpha, drop.alpha));
			GL11.glTranslated(H.calculateRenderPos(drop.prevPos.x, drop.pos.x), H.calculateRenderPos(drop.prevPos.y, drop.pos.y), 0);
			GL11H.rotateXYZAt(0, 0, -drop.scale*drop.alpha*300, 14, 25, 0);
			
			FirstPersonGui.drawRect(1F/368, 1F/399, 0, 0, 340, 0, 28, 51);
			
			GL11.glPopMatrix();
		}
		GL11H.color(color);
		FirstPersonGui.drawRect(1F/368, 1F/399, 0, 0, 170, 0, 170, 399);
		GL11.glColor4f(1, 1, 1, 1);
		FirstPersonGui.drawRect(1F/368, 1F/399, 0, 0, 0, 0, 170, 399);
		GL11H.EndOpaqueRendering();
		GL11.glPopMatrix();
	}
	private static class Drop{
		public boolean dead=false;
		public Vector2f pos,prevPos;
		public float alpha,prevAlpha,scale,speed;
		public Drop(Vector2f pos, float scale){
			this.pos = pos;
			this.scale = scale;
		}
		
	}
}
